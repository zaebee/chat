# ğŸ”¥ Simple Code Review - AGRO/PAIN Track
# Sacred Justification: Fast, practical feedback without philosophical overhead

name: "Simple Code Review"

on:
  pull_request:
    paths:
      - "**/*.ts"
      - "**/*.js"
      - "**/*.py"
      - "**/*.vue"
      - "frontend/**"
      - "hive/**"

jobs:
  agro_pain_fast_feedback:
    name: "âš¡ Fast Developer Feedback"
    runs-on: ubuntu-latest

    steps:
    - name: "ğŸ“¥ Checkout Code"
      uses: actions/checkout@v4

    - name: "ğŸ¯ TypeScript Zero-Any Check"
      id: type_check
      run: |
        echo "ğŸ” Scanning for 'any' types in source files..."
        if find . -name "*.ts" -o -name "*.vue" | grep -v node_modules | grep -v dist | grep -v build | grep -v static | xargs grep -l ": any\b\|<any\b\|any\[\]\|any\s*|" 2>/dev/null; then
          echo "âŒ Found 'any' types in source files - consider specific types for better code safety"
          echo "any_violations=true" >> $GITHUB_OUTPUT
          find . -name "*.ts" -o -name "*.vue" | grep -v node_modules | grep -v dist | grep -v build | grep -v static | xargs grep -l ": any\b\|<any\b\|any\[\]\|any\s*|" 2>/dev/null | head -5
        else
          echo "âœ… No 'any' types found in source files - excellent type safety!"
          echo "any_violations=false" >> $GITHUB_OUTPUT
        fi

    - name: "ğŸš€ Production Ready Check"
      id: prod_check
      run: |
        echo "ğŸ” Scanning for console.log statements in source files..."
        if find . -name "*.ts" -o -name "*.js" -o -name "*.vue" | grep -v node_modules | grep -v dist | grep -v build | grep -v static | xargs grep -l "console\.\(log\|warn\|error\|info\|debug\)" 2>/dev/null; then
          echo "âŒ Found console.log statements in source files - remove for production readiness"
          echo "console_violations=true" >> $GITHUB_OUTPUT
          find . -name "*.ts" -o -name "*.js" -o -name "*.vue" | grep -v node_modules | grep -v dist | grep -v build | grep -v static | xargs grep -l "console\.\(log\|warn\|error\|info\|debug\)" 2>/dev/null | head -5
        else
          echo "âœ… No console.log found in source files - production ready!"
          echo "console_violations=false" >> $GITHUB_OUTPUT
        fi

    - name: "ğŸ“Š Fast Feedback Summary"
      run: |
        echo "## ğŸ”¥ AGRO/PAIN Fast Feedback Summary" > simple_review.md
        echo "" >> simple_review.md

        if [ "${{ steps.type_check.outputs.any_violations }}" = "true" ]; then
          echo "### âŒ Type Safety Issues" >> simple_review.md
          echo "- Found 'any' types - consider specific interfaces" >> simple_review.md
          echo "- **Fix**: Replace \`any\` with specific types" >> simple_review.md
          echo "" >> simple_review.md
        else
          echo "### âœ… Type Safety: EXCELLENT" >> simple_review.md
          echo "" >> simple_review.md
        fi

        if [ "${{ steps.prod_check.outputs.console_violations }}" = "true" ]; then
          echo "### âŒ Production Readiness Issues" >> simple_review.md
          echo "- Found console.log statements" >> simple_review.md
          echo "- **Fix**: Remove console.log before production" >> simple_review.md
          echo "" >> simple_review.md
        else
          echo "### âœ… Production Ready: EXCELLENT" >> simple_review.md
          echo "" >> simple_review.md
        fi

        if [ "${{ steps.type_check.outputs.any_violations }}" = "false" ] && [ "${{ steps.prod_check.outputs.console_violations }}" = "false" ]; then
          echo "## ğŸ† **PERFECT CODE - READY TO SHIP!**" >> simple_review.md
          echo "" >> simple_review.md
          echo "No issues found. Excellent work! ğŸ¯" >> simple_review.md
        else
          echo "## ğŸ”§ **QUICK FIXES NEEDED**" >> simple_review.md
          echo "" >> simple_review.md
          echo "Simple fixes for better code quality. Keep shipping! ğŸš€" >> simple_review.md
        fi

        echo "" >> simple_review.md
        echo "---" >> simple_review.md
        echo "âš¡ **AGRO/PAIN Track**: Fast feedback, zero philosophy" >> simple_review.md
        echo "ğŸ¯ **Review time**: < 30 seconds" >> simple_review.md

        cat simple_review.md

    - name: "ğŸ’¾ Upload Fast Review Report"
      uses: actions/upload-artifact@v4
      with:
        name: simple-review-report
        path: simple_review.md

    - name: "ğŸ¯ Set Exit Status"
      run: |
        if [ "${{ steps.type_check.outputs.any_violations }}" = "true" ] || [ "${{ steps.prod_check.outputs.console_violations }}" = "true" ]; then
          echo "âš ï¸ Issues found - but shipping is still possible with quick fixes!"
          exit 1
        else
          echo "ğŸ† All checks passed - ready to ship!"
          exit 0
        fi